<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Capture</title>
</head>
<body>
    <h1>Face Capture Application</h1>
    
    <div>
        <button id="startBtn">Start Camera</button>
        <button id="stopBtn" disabled>Stop Camera</button>
        <button id="captureBtn" disabled>Capture Face</button>
    </div>
    
    <div>
        <video id="video" width="640" height="480" autoplay></video>
    </div>
    
    <div>
        <h2>Captured Image</h2>
        <canvas id="canvas" width="640" height="480"></canvas>
    </div>
    
    <div id="status"></div>

    <script>
        // LINE 1: Find the <video> element in HTML and store it in variable 'video'
        // Output: video = <video id="video" width="640" height="480" autoplay></video>
        const video = document.getElementById('video');
        
        // LINE 2: Find the <canvas> element and store it in variable 'canvas'
        // Output: canvas = <canvas id="canvas" width="640" height="480"></canvas>
        const canvas = document.getElementById('canvas');
        
        // LINE 3: Get the 2D drawing context from canvas (this lets us draw on it)
        // Output: ctx = CanvasRenderingContext2D object (tool for drawing)
        const ctx = canvas.getContext('2d');
        
        // LINE 4-6: Find all three buttons and store them
        // Output: startBtn = <button id="startBtn">Start Camera</button>
        // Output: stopBtn = <button id="stopBtn" disabled>Stop Camera</button>
        // Output: captureBtn = <button id="captureBtn" disabled>Capture Face</button>
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const captureBtn = document.getElementById('captureBtn');
        
        // LINE 7: Find the status div
        // Output: status = <div id="status"></div>
        const status = document.getElementById('status');
        
        // LINE 8: Create a variable to hold the camera stream, initially null
        // Output: stream = null (no camera yet)
        let stream = null;

        // FUNCTION DEFINITION: This function starts the camera (doesn't run until called)
        async function startCamera() {
            try {
                // LINE 9: Ask browser for camera access with specific settings
                // Output: stream = MediaStream object (contains video data from camera)
                // This line WAITS for user to allow/deny camera permission
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'  // front-facing camera
                    },
                    audio: false  // no audio needed
                });
                
                // LINE 10: Connect the camera stream to the video element
                // Output: Video on screen starts showing live camera feed
                video.srcObject = stream;
                
                // LINE 11-13: Update button states
                // Output: "Start Camera" button becomes gray/disabled
                // Output: "Stop Camera" button becomes clickable
                // Output: "Capture Face" button becomes clickable
                startBtn.disabled = true;
                stopBtn.disabled = false;
                captureBtn.disabled = false;
                
                // LINE 14: Show success message
                // Output: Text "Camera started successfully" appears in status div
                status.textContent = 'Camera started successfully';
                
            } catch (err) {
                // If camera fails (user denied, no camera, etc.)
                // Output: Error message appears in status div
                status.textContent = 'Error: ' + err.message;
                console.error('Camera error:', err);  // Also logs to browser console
            }
        }

        // FUNCTION DEFINITION: This function stops the camera
        function stopCamera() {
            // LINE 15: Check if camera stream exists
            if (stream) {
                // LINE 16: Stop all camera tracks (turns off camera light)
                // Output: Camera indicator light turns off
                stream.getTracks().forEach(track => track.stop());
                
                // LINE 17: Remove stream from video element
                // Output: Video screen goes black
                video.srcObject = null;
                
                // LINE 18: Clear the stream variable
                // Output: stream = null
                stream = null;
                
                // LINE 19-21: Update button states
                // Output: "Start Camera" becomes clickable again
                // Output: "Stop Camera" becomes disabled
                // Output: "Capture Face" becomes disabled
                startBtn.disabled = false;
                stopBtn.disabled = true;
                captureBtn.disabled = true;
                
                // LINE 22: Show stopped message
                // Output: Text "Camera stopped" appears in status div
                status.textContent = 'Camera stopped';
            }
        }

        // FUNCTION DEFINITION: This function captures the current video frame
        function captureImage() {
            // LINE 23: Draw current video frame onto canvas
            // Output: Canvas shows a frozen snapshot of whatever is in the video
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // LINE 24: Update status message
            // Output: Text "Image captured!" appears in status div
            status.textContent = 'Image captured!';
        }

        // LINE 25-27: Attach event listeners (connect buttons to functions)
        // Output: When "Start Camera" is clicked, startCamera() runs
        // Output: When "Stop Camera" is clicked, stopCamera() runs
        // Output: When "Capture Face" is clicked, captureImage() runs
        startBtn.addEventListener('click', startCamera);
        stopBtn.addEventListener('click', stopCamera);
        captureBtn.addEventListener('click', captureImage);

        // LINE 28: Add cleanup when user closes/refreshes page
        // Output: Camera turns off automatically if page is closed
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>